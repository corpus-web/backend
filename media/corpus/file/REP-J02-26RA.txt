<title>Features of Particle and Heavy Ion Transport code System (PHITS) version 3.02</title>
<author>Tatsuhiko Sato, Yosuke Iwamoto, Shintaro Hashimoto, Tatsuhiko Ogawa, Takuya Furuta, Shin-ichiro Abe, Takeshi Kai, Pi-En Tsai, Norihiro Matsuda, Hiroshi Iwase, Nobuhiro Shigyo, Lembit Sihver & Koji Niita</author>
<Affiliation>aNuclear Science and Engineering Center, Japan Atomic Energy Agency, Tokai, Japan; bRadiation Science Center, High Energy Accelerator Research Organization, Tsukuba, Japan; cKyushu University, Department of Applied Quantum Physics and Nuclear Engineering, Fukuoka, Japan; dTechnische Universität Wien, Atominstitut, Vienna, Austria; eResearch Organization for Information Science and Technology, Tokai, Japan</Affiliation>
<year>2017</year>
<Jounral>Journal of Nuclear Science and Technology</Journal>
<Publishing_house>Taylor & Francis</Publishing_house>
<Text_Collector>田苗，BFSU</Text_Collector>
<DOI>10.1080/00223131.2017.1419890</DOI>
<URL>https://doi.org/10.1080/00223131.2017.1419890</URL>
ABSTRACT
We have upgraded many features of the Particle and Heavy Ion Transport code System (PHITS) and released the new version as PHITS3.02. The accuracy and the applicable energy ranges of the code were greatly improved and extended, respectively, owing to the revisions to the nuclear reaction models and the incorporation of new atomic interaction models. Both condense his- tory and track-structure methods were implemented to handle the electron and positron trans- port, although the latter is reliable only for simulations in liquid water. In addition, several user- supportive functions were developed, such as new tallies to efficiently obtain statistically better results, radioisotope source-generation function, and software tools useful for applying PHITS to medical physics. Owing to the continuous improvement and promotion of the code, the number of registered users has exceeded 3,000, and it is being used in diverse areas of study, including accelerator design, radiation shielding and protection, medical physics, and cosmic-ray research. In this paper, we summarize the basic features of PHITS3.02, especially those of the physics models and the functions implemented after the release of PHITS2.52 in 2013.
KEYWORDS
PHITS; Monte Carlo; particle transport simulation; nuclear reaction; atomic interaction; nuclear data; radioisotope decay
1.Introduction
Monte Carlo particle transport simulation codes are an essential tool used in various fields of research such as radiation shielding, radiological protection, and med- ical physics. We are therefore developing Particle and Heavy Ion Transport code System (PHITS) [1], which can transport most of the particle species with ener- gies up to 1 TeV (per nucleon for ion) by using several nuclear reaction models and data libraries. The valida- tion and verification of the code were thoroughly per- formed for various applications on the basis of a bench- mark study of more than 50 irradiation scenarios [2]. All contents of the system, such as the source code and executable files, data libraries, and graphic utility, are fully integrated into one package and have been dis- tributed to many countries via the Research organiza- tion for Information Science and Technology (RIST), Data Bank of the Organization for Economic Co- operation and Development’s Nuclear Energy Agency (OECD/NEA DB), and Radiation Safety Information Computational Center (RSICC).
PHITS can be executed on the Windows,  Mac,  and Linux platforms. Distributed and shared mem- ory parallelization techniques are available using Mes- sage Passing Interface (MPI) protocols and open multi- processing (OpenMP) directives, respectively. Hybrid parallelization using both MPI and OpenMP is feasible
as well [3]. The source code of PHITS is written in For- tran, and the recommended compiler is Intel Fortran
11.1 (or later versions). Gfortran 4.7 (or later versions), too, can compile PHITS, but it has some limitations such as failure in compilation by using the OpenMP or optimization options. Various quantities, such as heat deposition, track length, and production yields, can  be obtained by means of PHITS simulation using the implemented “tally” estimator functions. In addition, users can deduce any information for their own needs, such as event lists of a certain type of nuclear reac- tions, by writing a user-defined tally program. More- over, the time evolution of radioactivity can be esti- mated by using DCHAIN-SP [4], which is included in the PHITS package.
The geometrical configuration of a simulation must be set with general geometry (GG) in a manner simi- lar to MCNP [5]. The interactive solid modeler Simple- Geo [6] can be used for generating the geometries writ- ten in PHITS-readable GG format. Computer-aided Design (CAD)-based geometries can be incorporated into PHITS by converting CAD data into tetrahedral- mesh geometries [7]. In addition, CAD geometries can be directly converted into the PHITS-readable GG for- mat by using SuperMC [8]. Electromagnetic fields and gravity can be considered in transport simulation of all particles including neutrons.
Figure . Map of the physics models and the data libraries rec- ommended for use in PHITS. to simulate nuclear and atomic collisions.
Recently, an upgraded version of the code, PHITS3.02, was developed and  released  to  public.  In our previous report, we provided detailed descrip- tions of the features of PHITS2.52 [1]. Therefore, this paper is focused on reviewing the features of the physics models and the user-supportive functions newly imple- mented or improved after version 2.52. Note that some updates between the two versions can be found in the conference proceedings [9,10]. The accuracies of each physics model and that of PHITS3.02 itself are not  discussed in this manuscript because the comprehen- sive benchmark results of a recent version of PHITS, version 2.88, have been presented elsewhere [2].
2.Upgrades to physics models
Figure 1 shows the physics models and data libraries recommended for use in PHITS3.02 to simulate nuclear and atomic collisions. These models and libraries are selected in the default setting, except for EGS5 [11] and the track-structure mode because electron and positron transport simulations are generally time consuming. The followings are the major upgrades to the physics models after version 2.52.
2.1.Improvement of nuclear reaction models
The maximum energy of nuclear reactions that can be handled by PHITS has been extended from 100 GeV to 1 TeV (per nucleon for ions) because of the revisions made to the high-energy nuclear reaction model JAM [12]. The nucleus–nucleus interaction model JQMD
[13] was further improved to version 2.0, which allows for more precise reproduction of fragmentation cross sections by incorporating the reaction mechanisms that are particularly important for peripheral collisions [14]. In addition, a combination model between JAM and JQMD, called JAMQMD, was developed for simulating nucleus–nucleus reactions over 3 GeV/u. The details of JAMQMD along with its benchmark results will be pre- sented in our forthcoming paper. These improvements
are especially important for cosmic-ray transport sim- ulation.
The energy ranges of the photonuclear reactions simulated by PHITS were extended by implementing the models describing nuclear resonance florescence (NRF) [15] and high-energy photonuclear reactions based on JAM and JQMD [16]. The implementation of the NRF model allows for the analysis of non- destructive assays of fissile nuclear materials by using PHITS. Moreover, muon-induced nuclear reaction models were incorporated to consider virtual photonu- clear reactions, as well as the negative muon capture reaction after the formation of a muonic atom [17].
The event generator mode (EGM) was upgraded to version 2 by developing a new reaction ejectile sam- pling algorithm to recover kinematic correlations from the inclusive cross-section data [18]. The energy spec- trum of secondary particles emitted from neutron inter- actions below 20 MeV can be determined precisely  based the inclusive cross-section data, even for cases of charged particles and multiple-neutron emissions. This improvement allows PHITS to estimate the soft-error rates of semi-conductor devices induced by neutrons [19].
The nucleus de-excitation algorithm in the evapora- tion model GEM [20] was improved by implementing EBITEM [21], thus allowing for precise estimation of γ -ray spectra and isomer production rates. In addition, the competition between neutrons and γ -ray emissions can be considered in the improved GEM, whereas in the former version, it was presumed that an excited nucleus can emit γ -rays only when neutron emission is pro- hibited. These improvements allow PHITS to be used for prompt γ -ray analyses, which is useful for various purposes such as design of online trajectory imaging for charged-particle therapy based on gamma cameras [22].
The Kerma factors of some nuclei contained in JENDL-4.0 [23] were revised. DCHAIN-SP was improved by expanding the number of energy groups in its neutron-activation cross-section libraries [4]. New options for calculating the total reaction cross sections, namely, the hybrid Kurotama model (default) [24], Sato’s formula [25], and Minomo–Washiyama– Ogata (MWO) formula [26], were implemented. A new approach for describing the (d,xn) spectra of Li, Be, and C targets at energies below 50 MeV was devel-  oped in combination with the intranuclear cascade model INCL4.6 [27] and the Distorted Wave Born Approximation (DWBA) [28].
2.2.Improvements on atomic interaction models
The EGS5 algorithm was introduced for simulating atomic interactions of electrons, positrons, and pho- tons over a wide energy ranging from 1 keV to 1 TeV. This implementation improves the accuracy of electron
transport simulation, especially for lower energies, which is very important from the viewpoint of medical physics applications [29]. In addition, consideration of electromagnetic fields in the transport of electrons and positrons became feasible. It should be noted that electrons and positrons must always be traced in the EGS5 mode in PHITS. This specification results in increased computational time of simulations that need not transport electrons and positrons, for example, radiation shielding and X-ray diagnostic simulations. Thus, the algorithm based on EPDL97 [30], which can transport photons without considering the productions of electrons and positrons, is selected in the default setting of PHITS3.02, and EGS5 is recommended for use only when the transport of electrons and positrons is required.
It should be also noted that the EGS5 algorithm employs a condensed history method that cannot be applied to electron and positron transport at energies lower than 1 keV. The track-structure mode was there- fore introduced for simulating lower energy electrons and positrons down to 1 meV [31], which explicitly treats not only ionization, electronic excitation, and dissociative electron attachment for electronic states but also vibration, phonon, and rotation excitations for molecular states. The track structure mode will be use- ful for the estimation of the quality and quantity of  radiation-induced DNA damages, which significantly depend on the spatial distributions of ionization and electronic excitation in nano-meter scales [32]. Cur- rently, only the cross sections of liquid water [33] are prepared for the track-structure mode, and the cross sections of other materials are simply deduced by scal- ing electron density to the water data.  The switch- ing energy between the EGS5 and the track-structure modes can be specified by users at energies higher than 1 keV. However, it is not recommended to set a very high value, e.g. above 100 keV, because the computational time of the track-structure mode is much longer than that of the EGS5 algorithm. Figure 2 shows the distribu- tion of deposition energy in water irradiated by 4-keV electrons from the left side, as calculated by PHITS3.02. Electrons in the upper and lower regions were simulated using the EGS5 and the track-structure mode, respec- tively. It is evident from the graph that electrons contin- uously and discretely deposit their energy in the upper and lower regions, respectively. Note that the track- structure mode is not activated in the default setting of PHITS3.02 in the same manner as in the EGS5 algo- rithm.
The ATIMA [34] algorithm in PHITS was modified to record stopping power data for each combination of particle and material when the combination appears during transport calculation, and recorded data are reused for the next time. This modification consider- ably increases the computational speed so that ATIMA is selected as the default stopping power calculation
Figure . Distribution of deposition energy in water irradiated by -keV electrons from the left side, as calculated by PHITS.. Electrons in the upper and lower regions were simulated using the EGS and track-structure modes, respectively.
model in PHITS3.02 [35]. The production of knock- out electrons, so-called δ-rays, above a certain threshold energy can be considered explicitly, while the remaining deposition energies are estimated from the restricted stopping power, which can be calculated by subtract- ing the mean energy of δ-rays per mean free path of δ-ray production from the total stopping power based on the Butts and Katz model [36]. The muon transport algorithm was also improved by considering the mech- anisms of pair production, bremsstrahlung, and char- acteristic X-rays from muonic atoms, in addition to the muon-induced nuclear reactions, as mentioned above.
3.Upgrades to supportive functions
In addition to the physics models, several user-support functions were developed for extending the capabili- ties of PHITS. The followings are the major upgrades to the supportive functions implemented after version 2.52, and the details of each function can be found in the PHITS manual [37].
3.1.Improvements on tallies
Two new tallies, weight-window generator and point estimator, were implemented to more efficiently obtain tally results with better statistics. The former automati- cally determines an appropriate weight window in spec- ified regions by counting the number of Monte Carlo particles incident on each region, while the latter cal- culates the particle fluence at a certain point by using cross-section libraries. Note that the point estimator cannot be used in tandem with nuclear reaction models, and thus, it can be applied only to neutrons with ener- gies lower than 20 MeV and photon transport simula- tions in PHITS.
Figure . ParaView visualization of absorbed doses in skeletal tissue of International Commission on Radiological Protection (ICRP) adult male phantom [] irradiated with -GeV protons in PHITS simulation.
A new user-support function in terms of visual-  ization was developed to output PHITS tally results into a format readable by ParaView [38], which is an open-source, multi-platform data analysis, and visual- ization application. Figure 3 shows the ParaView visu- alization of the absorbed doses in skeletal tissue of   the International Commission on Radiological Pro- tection (ICRP) adult male phantom [39] irradiated with 1-GeV protons in the PHITS simulation. In Par- aView, the tally results of any physical quantities can be visualized by interactively selecting the user-interested regions, materials, and particle contributions. In addi- tion, each particle track simulated by PHITS can be also drawn using ParaView. Note that the graphical utility included in the PHITS package, ANGEL, has functions for the three-dimensional (3D) visualization of geometry and two-dimensional (2D) visualization of tally results, but not for 3D visualization of tally results.
Tallies for calculating the volume, mass, and shield- ing distribution of each region were implemented based on the ray-tracing method. Detector resolutions can be considered when calculating the pulse-height distribu- tion by specifying a fano factor. Absorbed dose in unit of Gy now can be calculated by considering the mass of the tally regions. Moreover, relative biological effec- tiveness (RBE)-weighted dose used for charged parti- cle therapy can be directly estimated using the PHITS- based microdosimetric kinetic model [40]. Particle flu- ences can be calculated in cylindrical coordinates as a function of the azimuth angle. In addition, several user- supportive functions related to tallies were developed and introduced, including those for visualizing geome- try errors, summing up two (or more) tally results, and defining a user’s original tally.
3.2.
Improvements to source-generation functions
A new source-generation function that can automat- ically determine the α, β, and γ -ray spectra emitted from radioisotope decay was developed to consider the contributions of daughter nuclides. The generation of Auger electrons can be also considered using this func- tion. The nuclear-decay data files for dosimetry calcu- lation, DECDC [41], which is equivalent to those in the database contained in ICRP Publication 107 [42], were employed as the reference data for the nuclear-decay chains. The input parameters to be specified in this function are name and activity (Bq) of initially exist- ing radioisotopes and the time required to consider the activities in terms of by time evolution, including their decay chains. The details of this function will be pre- sented in our forthcoming paper.
For simulating radioisotope sources that emit two (or more) radiations during their decay, we developed a function that generates multiple particles as an event while taking their angular correlation into account. This function is especially important for simulating micro- dosimetric profiles of boron neutron capture therapy, because an α particle and a 7Li ion are generated at the same location but in opposite directions during a 10B(n,α)7Li reaction.
Moreover, we implemented source-generation func- tions for producing spontaneous fission neutrons [43] and for reading of International Atomic Energy Agency (IAEA) phase space files [44]. The former are useful for simulating radiological protection of internal exposure to spontaneous fission nuclides [45], whereas the latter are beneficial for medical physics simulations of X-ray therapy.
3.3.Development of new functions and software useful for medical applications
Two software tools useful for applying PHITS to medi- cal physics, DICOM2PHITS and PHITS2DICOM, were developed and incorporated into the PHITS package.
Figure . Examples of the results of DICOMPHITS (left) and PHITSDICOM (right).
Figure .  D views of tetrahedral phantom [] depicted by PHITS. The upper and lower panels show representations of         the entire body and that excluding skin and soft tissue, respectively.
DICOM2PHITS can automatically convert Computed Tomography (CT) image data written in the Digital Imaging and Communications in Medicine (DICOM) format to the PHITS-readable GG format based on lattice structure. Users can select either the standard
[46] or their original conversion table from CT val- ues to material information in this software. On the other hand, PHITS2DICOM can automatically convert the PHITS tally results to the DICOM RT-dose for- mat, which is frequently used for visualizing dose distri- butions inside patients in practical treatment planning systems. Figure 4 shows two sample results obtained from the two software tools, one is the 3D visualization of a physical phantom converted by DICOM2PHITS and the other is the dose distribution in the phan-  tom generated by PHITS2DICOM depicted along with DICOM image data. These pictures were drawn using PHITS and a free DICOM software called dicompyler [47], respectively. Owing to the development of these software tools, dose calculations for each patient using his/her own CT data became feasible, even for medical physicists who are not familiar with the details of PHITS and DICOM formats.
Although voxel phantoms, which can be created eas- ily by using DICOM2PHITS, are used widely in the current medical-physics and radiological-protection simulations, polygonal-mesh phantoms have attracted increasing attention owing to their flexibility. We there- fore developed the capability to read tetrahedral geome- try (a type of polygonal geometry) into PHITS. To accel- erate the computational speed in the transport process, an algorithm was developed to initially prepare decom- position maps for the container box of the tetrahedral- mesh geometry. Owing to this algorithm, the com-  putational cost of transporting particles in tetrahedral geometry is essentially equivalent to that in voxel geom- etry with the same mesh number [7]. Figure 5 shows 3D views ofa tetrahedral phantom [48] depicted by PHITS. In general, a tetrahedral phantom consists of consider- ably fewer meshes compared to its voxelized represen- tation owing to the adaptability of tetrahedrons in terms
of both size and shape. Thus, significant acceleration of the computational speed can be expected by replac- ing the voxel phantom with the tetrahedral phantom in PHITS-based treatment planning systems, which are currently under development in several institutes in Japan.
4.Conclusions and future plans
We upgraded many aspects of the PHITS code and released the new version as PHITS3.02. PHITS has been used in many countries for various purposes, such as accelerator design, radiation shielding and protection, medical physics, and cosmic-ray research. The tutorials of the code are organized more than 10 times per year in Japan, and several times in other countries, namely, China, France, Korea, Malaysia, Philippines, Sweden, Taiwan, and Vietnam, so far. Owing to the continuous improvement and promotion of the code, the number of registered users exceeded 3,000 in 2017, and it has been rapidly increasing ever since.
Several tasks necessary for further development of PHITS remain to be completed. The incorporation of a high-energy version of evaluated nuclear data library JENDL-4.0/HE and the photonuclear data file JENDL- PD in the PHITS package is in progress for improv- ing the accuracy of simulating nucleon- and photon- induced nuclear reactions between 20 and 150 MeV. A function to read the cross-section data libraries of light ions such as deuteron is under development as well. We plan to extend the track-structure mode in PHITS to other particles and materials. Development of an algo- rithm to deduce systematic uncertainties in the tally results attributable to the inaccuracy of nuclear reaction models and libraries is another ongoing project.
Acknowledgments
We are grateful for the support of Center for Computational Science & e-Systems (CCSE) of JAEA in promoting PHITS. We wish to thank Dr Y. Namito and Dr H. Hirayama at KEK for their support on implementing the EGS5 algorithm into PHITS, Prof. Y. Mizuno at Kyoto Women’s University for his advice in implementing the muon reaction models, Dr A. Endo at JAEA for his support in developing the radioiso- tope source generation function, Dr K. Okumura at JAEA for revising JENDL-4.0 contained in the PHITS package, Dr Tetsuya Kai at JAEA for providing an upgraded version of DCHAIN-SP, Dr K. Furutaka at JAEA for his advice in devel- oping ParaView visualization function, Dr L. Pong Hong at NAIS Co. Ltd. for his support in developing the function for generating fission neutron sources, Dr Y. Koba at National Institute of Radiological Science for his advice in developing PHITS2DICOM, and Prof. T. Takemura at Kanazawa Univer- sity for providing the CT image data of a physical phantom used as a sample input of DICOM2PHITS. The function to read tetrahedral geometry was implemented under the sup- port of Hanyang University Radiation Engineering Labora- tory (HUREL), the Republic of Korea.
This study was partially supported by Japan Society for
the Promotion of Science (JSPS), KAKENHI, [grant num- ber JP24860072], [grant number JP26790072], [grant num- ber JP16H02959], [grant number JP16H04459], [grant num- ber JP17K07022].
