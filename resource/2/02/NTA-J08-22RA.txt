<title>Advanced  approach to the analysis  of a series of in-situ nuclear forward	 scattering experiments</title>
<Affiliation>a.Department of Experimental Physics, Faculty of Science, Palacký University Olomouc, 17. listopadu 12, 771 46 Olomouc, Czechia
b.Slovak University of Technology in Bratislava, Faculty of Electrical Engineering and Information Technology, Institute of Nuclear and Physical Engineering, Ilkovicova 3, 812 19 Bratislava, Slovakia
c.Department of Nuclear Reactors, Faculty of Nuclear Science and Physical Engineering, Czech Technical University in Prague, V Holešovičkách 2, 180 00
Prague, Czechia</Affiliation>
<author>Vlastimil Vrb, Vít Procházk, David Smrčk, Marcel Miglierini</author>
<year>2015</year>
<Jounral>Nuclear Instruments and Methods in Physics Research A</Journal>
<Publishing_house> Elsevier </Publishing_house>
<Text_Collector>田苗，BFSU</Text_Collector>
<DOI>10.1016/j.nima.2015.07.014</DOI>
<URL>http://dx.doi.org/10.1016/j.nima.2015.07.014</URL>
ABSTRACT
This study introduces a sequential ﬁtting procedure as a speciﬁc approach to nuclear forward  scattering (NFS) data evaluation. Principles and usage of this advanced evaluation method are described in details and its  utilization is demonstrated on NFS in-situ investigations of fast processes. Such experiments frequently consist    of hundreds of time spectra which need to be evaluated. The introduced procedure allows the analysis of these experiments and signiﬁcantly decreases the time needed for the data evaluation. The key contributions of the  study are the sequential use of the output ﬁtting parameters of a previous data set as the input parameters for     the next data set and the model suitability crosscheck option of applying the procedure in ascending and descending directions of the data sets. Described ﬁtting methodology is beneﬁcial for checking of model validity and reliability of obtained results.
Keywords:
Nuclear forward scattering Data evaluation
In-situ experiments Crystallization Chemical reaction
1.Introduction
With current high brilliance synchrotron radiation sources nuclear forward scattering (NFS) [1–4] has become a suitable experimental technique for investigation of various types of processes in a solid state such as chemical and phase transformations or a system development with a dynamic change of conditions [5,6]. Information on the studied processes is contained in a sequence of measured NFS time spectra. This is accompanied by a new demand on the evaluation procedures. However, physical reliability of results and conclusion should be ensured.
NFS gives a unique information on fast processes in studied systems, but the evaluation of measured time spectra can be diﬃcult. NFS data evaluation is usually realized by ﬁtting calculated time spectra to experimental data. Parameters describing the theoretical curve are reﬁned during the ﬁtting process. For evaluation of individual time spectra several programs have been developed including CONUSS [7,8], MOTIF [9] or FitSuite [10]. Crucial task of NFS data evaluation is to ﬁnd an appropriate model describing the studied system. All nuclei in speciﬁc conditions, i.e. diﬀerent chemical, structural and magnetic surroundings, contribute to one model component. Each component in the model is described by a set of parameters including relative amount of corresponding resonant nuclei, hyperﬁne parameters, their distribu-
tions and texture. During the investigated process some components might disappear and new components might appear in the system as the latter might undergo magnetic or structural transformations. Many parameters may also be signiﬁcantly changing during the process. Consequently, the physical model applied in the ﬁtting should be modiﬁed. Therefore evaluation is even more complicated when obser- ving the whole process via a sequence of measured time spectra.
For samples enriched by 57Fe the achievable accumulation time of one time spectrum is approximately one minute. For the processes which last from several minutes to hours the total number of time spectra which need to be evaluated rises up to hundreds [6]. Therefore automation of the evaluation procedure would bring signiﬁcant in- crease of eﬃciency of NFS data analysis. In [11] an approach using artiﬁcial neural network (ANN) for the analysis of nuclear resonant scattering experiments was introduced. By using this method time requirement for time spectra evaluation was signiﬁcantly decreased. However, suﬃcient time for neural network initial training is still needed and there are limitations in a range of relevant parameters describing the time spectra for ANN analysis to be eﬃcient.
In this paper we introduce sequential ﬁtting procedure (SFP) which is based on a conventional ﬁtting method and connects neighbouring time spectra through their input and output values of ﬁtted parameters. After manual evaluation of one time spectrum SFP is initiated and the
rest of time spectra is evaluated automatically. This is not a new idea, however, the aim of this paper is to describe in detail a wide range of diﬀerent aspects connected with SFP and show several advantages of SFP used for analysis of NFS experiments with a high number of acquired data. Several features connected with evaluation of a sequence of NFS time spectra are discussed, including checking of a validity of selected model by monitoring an agreement of theory with experi- mental data, checking hysteresis phenomena and correlations between ﬁtted parameters.
Utilization of SFP is demonstrated using examples of three diﬀerent physical processes. The ﬁrst example shows temperature evolution of magnetic hyperﬁne ﬁeld during the heating of hematite in the range close to its Néel temperature. The second process is crystallization in amorphous metals. It is a temperature induced process of formation of nanocrystalline grains in amorphous matrix [12,13]. Using the SFP method crystallization process was investigated in-situ under isother- mal and dynamic temperature conditions and inﬂuence of an external magnetic ﬁeld on the crystallization was studied [14,15]. The last application is an investigation of chemical reactions in a solid state, where thermal decomposition of potassium ferrates (transformation among K-Fe-O compounds with diﬀerent Fe valent states) was observed [16].
2.Sequential fttting procedure using hubert
Evaluation of NFS experimental data is based on calculation of the time spectrum according to a selected model and its comparison with the measured experimental data. Theoretical and experimental data,
described by the set of values {Tk} and {Ek} respectively, are compared
with respect to their statistical agreement quantiﬁed by χ2 parameter
@1
The sum runs over k = 1, 2, …, K where index k describes the corre- sponding delay times {tk} after the excitation synchrotron radiation pulse. The measurement standard deviation σk is usually estimated as
Ek . During the evaluation the values of model parameters are iteratively  changed and χ2 value is monitored. This  iterative process  is stopped after χ2 reaches selected stopping condition and ﬁtted parameters describing the model are obtained. The evaluation is inﬂuenced by the initial values of ﬁtted parameters. The ﬁtting process converges if the initial values are close enough to the real ones.
A sequence of NFS time spectra is accumulated during a process. In order to extract relevant information on the process each time spectrum should be evaluated properly. Moreover, not only values of the parameters corresponding to the individual time spectra should be determined correctly, but also their evolution over the whole time interval of the process should be “reasonable”. That means the time spectra should be analyzed properly as the whole sequence. SFP can be used for more eﬃcient analysis of NFS data sequences.
SFP proceeds in several steps. First, the initial values of ﬁtted parameters for evaluation of the ﬁrst time spectrum are set as close as possible to correct values. Then the ﬁtting process runs and the resulting values of ﬁtted parameters are obtained. In the next step connection between the ﬁrst and the second time spectrum is made. This is done by setting the output values from the ﬁrst time spectrum ﬁtting as starting values for the second time spectrum ﬁtting. After evaluation of the second time spectrum the connection between the second and the third time spectrum is made. This mechanism is applied  for  the  whole  sequence  of  the  time  spectra.  Fig.  1  shows
principles of SFP where n = 1, 2, …, N − 1 is index of the time spectra,ﬁtted out is set of output values of parameters.In  order  to  handle  the  iterative  ﬁtting  procedure  the  Hubert
Fig. 1. Schematic illustration of the SFP principle implemented in Hubert.
software has been created. Hubert is a free software developed by C+
+ programming language in QtCreator environment [17]. It uses SFP and the CONUSS software which runs at the background for ﬁtting the individual time spectra.
3.Fitting methodology
Strong and weak points of the sequential analysis approach are described on three examples: the temperature evolution of magnetic hyperﬁne ﬁeld in hematite, the crystallization process in amorphous metals and the solid state reaction. Closer information on the con- ducted experiments, used ﬁtting models and reliability of ﬁtted time spectra for the latter two examples can be found elsewhere [5,6,14–  16].
The essential condition for successful SFP is suﬃciently small diﬀerence between ﬁtted parameters of the neighbouring time spectra. SFP usually fails and the ﬁtting procedure doesn't converge in the range where some ﬁtting parameters change too rapidly or even step- wise. This might occur, for example, for very fast chemical reactions, structural transformations or magnetic transformations, where SFP fails due to a large change in hyperﬁne magnetic ﬁeld. The last mentioned case is demonstrated by a set of time spectra acquired during the heating of hematite [18]. The sample was heated up with
constant heating  rate  of 10 °C/min in a  wide range of  temperatures to approximately 1000 °C. One time spectrum corresponds to one minute of measurement. Fig. 2 shows selected time spectra in the temperature
range from 550 °C to 660 °C and compares resulted values of magnetic hyperﬁne ﬁeld obtained by ﬁtting the corresponding time spectra manually (each time spectrum was ﬁtted separately one by one) and by using the SFP approach. The results from SFP evaluation are in
Fig. 2. (a) Examples of NFS time spectra of hematite for diﬀerent temperatures in the temperature range close to the Néel temperature. The red curves represent ﬁt of the time spectra obtained using SFP. The misﬁt is clearly visible. (b) comparison of magnetic hyperﬁne ﬁeld values obtained by manual ﬁt and SFP ﬁt of the time spectra sequence.
agreement with the results from manual ﬁtting up to 620 °C. After that the change of the magnetic hyperﬁne ﬁeld starts to be too high (more than 1 T) as the temperature gets close to the Néel temperature of the
hematite [19] and SFP starts to give incorrect results.
In a real case of fast chemical or structural transformation in a time domain the process might start slowly, reach some fast transformation range and then continue slowly again. In that case the SFP can still be used. However, in the fast transformation range time spectra should be ﬁtted manually (bigger manual change in initial values is needed) and the rest can be ﬁtted sequentially again.
In  [14]  the  crystallization  process  of Fe81Mo8Cu1B10 amorphous
metals under dynamic temperature conditions was observed by NFS experiments. Samples in the form of thin ribbons with thickness about 20 μm were enriched by 57Fe to approximately 50% and measured in an
evacuated furnace. By placing the furnace between two  electromagnets
inﬂuence of an external magnetic ﬁeld of magnitude 0.652 T on the crystallization process was studied. A model with three components was used for analysis of measured time spectra. One component corresponds to the amorphous matrix described by the isomer shift  and the quadrupole splitting with a broad distribution. The amorphous component is paramagnetic in a studied temperature range. The second and third components correspond to the inner  and  surface part of the crystalline grains. Both components are ferromagnetic. The surface part is characterized by broad magnetic hyperﬁne ﬁeld dis- tribution.
During the measurement the samples were heated up from the room temperature with constant temperature rate 10 °C/min. NFS time spectra were measured continuously during the heating and each time
spectrum was accumulated during one minute. Analysis of the time spectra showed that the model is suﬃcient in a temperature range approximately up to 600 °C. After the proper manual ﬁtting of one time
spectrum the SFP was successfully applied for the whole considered
temperature range.
The validity of the model and reliability of ﬁtted parameters was tested. The interpretation of the results was performed in agreement with the described methodology and despite the uncertainty of some of the ﬁtted parameters the formation of crystalline grains was clearly observed.
Crucial task in SFP as well as for correct analysis of NFS experi- ments is to create a correct model for analysis of NFS experiments. The selected model should be ideally valid for the whole analyzed time spectra sequence. In cases where one physical model can't cover the whole experiment more models need to be used. However, an overlap between the models is appropriate. The basic way of checking the model validity is to follow the χ2 parameter and identify a range of the model validity by watching noticeable increases in χ2.
When interpreting the χ2 dependence one should check possible correlation of χ2 with the total number of counts in given time spectrum. In ideal case the χ2 should be close to one. However, there are often minor discrepancies between experimental data and used ﬁtting model, frequently caused by slightly diﬀerent line shape. Although these discrepancies have no inﬂuence on the interpretation  of model components the χ2 is consequently higher than one. Moreover, in this case the χ2 may increase with increasing data statistics as the relative errors of the experimental points decrease. In NFS the statistics of measured time spectra depends on the incoming
Fig. 3. Correlation between χ2 and total number of counts in NFS time spectra.
radiation intensity which might exhibit ﬂuctuations due to instabilities of high resolution monochromators (Fig. 3). This could result in observable changes in the χ2 that are not connected with the quality    of the used model.
However, if the correlation between the total number of counts and χ2 is not observed, the noticeable changes in χ2 may indicate that the used model fails and some spectral components might be incorrect or missing. Therefore the indication of using insuﬃcient model can be even easier for a sequence of time spectra than for a separate experiment.Another aspect of the data analysis especially using SFP is a correlation between diﬀerent parameters. The correlation may  occur  in cases where two or more ﬁtting parameters have similar inﬂuence on the time spectra. For example Lamb-Mössbauer factor and quadrupole splitting may cause similar eﬀect on the shape of hybrid beats [20]. Possible correlation between two parameters for a sequence of time spectra can be checked by ﬁxing one of the parameters, keeping the other parameters ﬁtted and then comparing the obtained dependen- cies. Behaviour of ﬁtted parameters can be also checked with setting several diﬀerent values for the ﬁxed parameter and comparing the results including the χ2 dependences. Using this approach one can exclude correlation between parameters and thus reliability of ﬁtted dependencies can be approved.
All discussed features are connected to the problem of multiple solutions where diﬀerent sets of ﬁtted values sometimes even with comparable χ2 values can be obtained. In that case validity of a chosen model should be checked for each set of values independently. For a given set the model might work just for the time spectra in a small range and fails for the rest of them. Physical interpretation of obtained values and exclusion of the unphysical dependencies is also required. However, identiﬁcation of the correct set of values is not always possible. Occurrence of multiple solutions can therefore considerably raise the uncertainty of ﬁtted parameter values and consequently complicate the analysis of the whole experiment and its interpretation. It is shown that for obtaining at least partial information from ﬁtted sets of values one can follow “trends” of the ﬁtted dependencies. By trends we mean typical characteristics of corresponding dependencies which are same for all the ﬁtted sets. These trends can be therefore interpreted independently on the knowledge of the real values of parameters. Fig. 4 shows resulting relative amount of the inner part
Fig. 4. Example of three ﬁtted dependencies of relative amount of the crystalline component (CR), crystalline component magnetic hyperﬁne ﬁeld and χ2 obtained for diﬀerent relative width (FWHM) of the magnetic hyperﬁne ﬁeld distribution.
of crystalline grains (denoted as CR), corresponding hyperﬁne mag- netic ﬁeld and χ2. Three dependences were obtained by using magnetic hyperﬁne ﬁeld distribution with diﬀerent relative width (FWHM)
during the ﬁtting procedure. The  relative distribution width  is given  as percentages of the corresponding hyperﬁne ﬁeld values. Despite the signiﬁcant diﬀerences between the results the characteristics of all the dependencies are the same. The beginning of the transformation can be identiﬁed from the trends in relative amounts of individual spectral components and magnetic hyperﬁne ﬁelds. The temperature of the transformation beginning is the same for all three sets of values.
Using the example of crystallization in amorphous metals, we have discussed several problems of NFS data analysis using SFP. The last discussed feature will be demonstrated on an example of solid state chemical reactions.
In [16] thermally induced chemical reaction in potassium ferrate samples was studied. Decomposition in powder samples was observed under isothermal conditions. One NFS time spectrum was accumulated during  one  minute.  K2FeO4  containing  iron  ions  in  valent  state 6+
decomposed at temperatures above 200 °C to KFeO with iron in the
valent state 3+. Except the initial and ﬁnal compound intermediate states undetectable by ex-situ methods were also observed. The experimental data were successfully ﬁtted by a  model  consisting  of ﬁve components where iron in diﬀerent valent states was represented by one component for each valent state.
Along with following the χ2 parameter the model imperfections can be also veriﬁed by reversing of SFP where a “hysteresis” eﬀect can be observed. It means that SFP gives diﬀerent results when it starts from one or from the another side of the data sequence (viz. ascending vs.
Fig. 5. Example of the hysteresis eﬀect. Results were obtained using (a) incomplete model with two components corresponding to K2FeVIO4 and KFeIIIO and (b) improved model  including intermediate components with FeIII, FeIV and FeVI.
descending time of in-situ NFS experiments). Fig. 5 shows comparison of two models used for analysis of the potassium ferrate decomposition. The model with two components corresponding to K2FeO4 transform- ing to KFeO is shown in 5(a). The hysteresis eﬀect can be seen clearly. In 5(b) the improved model including other three intermediate compounds evolving during the transformation is shown. The use of the improved model results in lowering of χ2 as well as disappearance of the hysteresis.
Although the mentioned features are helpful in checking the model validity χ2 increase or hysteresis observation itself doesn't provide any clue how to improve the model. In case of Mössbauer spectroscopy some missing or misinterpreted components in the model can be checked by analyzing positions and characters of spectral lines in the energy domain. In NFS checking of the model validity from analysis of the time domain dependencies is extremely diﬃcult. Nevertheless, NFS may give us a unique information regarding, for example, speciﬁc evolution of hyperﬁne parameters or new components occurring during the process. This might not be obtainable by other experimental techniques. Therefore observation of hysteresis could be a clue for indication of unknown physical phenomena. It should be noted that identiﬁcation of new ﬁtting components is possible only when suﬃ- ciently high number of NFS data is evaluated using, for example, this advanced SFP approach.
4.Conclusions
It was shown that a sequence of NFS time spectra can be eﬀectively evaluated using the SFP approach. Its use is especially helpful for in- situ studies of processes where up to hundreds of accumulated time spectra are evaluated. In such cases usage of SFP can decrease the time needed for data evaluation signiﬁcantly. Although in-situ NFS is not a routine experimental technique its importance grows up as the current photon sources develop. Considerable increase in the synchrotron radiation brilliance in free electron lasers can be expected in the future. Consequently much faster chemical processes will become observable by this technique.
The metallic glasses crystallization study and thermal decomposi- tion in potassium ferrate samples have been successfully analyzed by
the Hubert program with SFP implemented. The analysis included checking of the model validity and reliability of the values of ﬁtted parameters. Despite the problems connected with the time spectra evaluation such as correlations and equivalent multiple solutions the sequential ﬁtting oﬀers a possibility of extracting relevant information on studied processes by following the trends of ﬁtted parameters.
Acknowledgements
The authors gratefully acknowledge the support by the internal IGA grant of Palacký University (IGA_PrF_2016_022), the project GACR 14-12449S, and the Project VEGA 1/0182/16. The authors would also like to thank Helena Sedláčková (Palacký University Olomouc, Czech Republic) for her help with this paper.
